#include <lt_function/lt_function_error.h>

client::client(client_callback *_cb) : cb(_cb), sess(NULL)
{
}

int client::connect(const std::string &ip)
{
    std::lock_guard<std::mutex> lck(m);
    if ( sess )
        return 0;
    sess = cb->get_session(ip);
    if ( !sess )
        return -RPC_ERROR_TYPE_CONNECT_FAIL;

    try
    {
        sess->connect(ip, SERVER_PORT);
    } catch (...)
    {
        return -RPC_ERROR_TYPE_CONNECT_FAIL;
    }
    return RPC_ERROR_TYPE_OK;
}

void client::disconnect()
{
    std::lock_guard<std::mutex> lck(m);
    if ( !sess )
        return;
    sess->disconnect();
    cb->put_session(sess);
    sess = NULL;
}
